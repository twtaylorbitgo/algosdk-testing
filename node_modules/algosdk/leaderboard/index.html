<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leaderboard</title>
    <style>
        #container {
            width: 600px;
            height: auto;
            position: center;
        }

        .center {
            margin: auto;
            width: 50%;
            padding: 10px;
        }

        .row {
            position: relative;
            display: block;
            width: 100%;
            height: 40px;
            border-bottom: 1px solid #AFAFAF;
        }

        .name {
            position: relative;
            display: inline-block;
            width: 75%;
            line-height: 45px;
        }

        .score {
            position: relative;
            display: inline-block;
            width: 25%;
        }

        .row:nth-child(1) {
            background: gold;
        }

        .row:nth-child(2) {
            background: #c0c0c0;
        }

        .row:nth-child(3) {
            background: #cd7f32;
        }
    </style>
</head>
<body>
<script>

    function sortRows () {
        let elements = [];
        let container = document.querySelector('#container');
        // Add each row to the array
        container.querySelectorAll('.row').forEach(el => elements.push(el));
        // Clear the container
        container.innerHTML = '';
        // Sort the array from highest to lowest
        elements.sort((a, b) => b.querySelector('.score').textContent - a.querySelector('.score').textContent);
        // Put the elements back into the container
        elements.forEach(e => container.appendChild(e))
    }
    document.addEventListener('DOMContentLoaded', () => {
        sortRows();
    });
</script>

<script src="../dist/algosdk.min.js"></script>
<script>

    function bin2String(array) {
        var result = "";
        for (var i = 0; i < array.length; i++) {
            result += String.fromCharCode(parseInt(array[i], 2));
        }
        return result;
    }

    var baseServer = "http://3.15.4.163";
    var port = "8080";
    var token = '14a6e674fa8acbf71f3c3fbbf6cc52ff34901e72f7c6d5608d2e03644f6e657f';


    var algodclient = new algosdk.Algod(token, baseServer, port);


    var address_to_track = "Q7DZCXS7MVKQKJFB7KTV6PVDRRX2BDGS47QS6CQCY6W3Y3L6SOPRNWKURU";

    var counter = 1;

    (async () => {
        let current_round = await algodclient.status();
        current_round = current_round.lastRound;
        console.log(current_round);

        while (0===0) {
            let temp_round = await algodclient.statusAfterBlock(current_round);
            temp_round = temp_round.lastRound;

            // let x = await algodclient.transactionByAddress(address_to_track, 10);

            let container = document.querySelector('#container');

            foo = function (data, r_score) {
                var node = document.createElement("div");
                node.className = "row";
                var name = document.createElement("div");
                name.className = "name";
                name.innerHTML = data;
                var score = document.createElement("div");
                score.className = "score";
                score.innerHTML = r_score;

                node.appendChild(name);
                node.appendChild(score);
                container.appendChild(node);
            };

            bar = function(txn) {
                if (txn.payment.to === address_to_track) {
                    foo(txn.note, counter);
                    counter += 1;
                }
            };

            x = await algodclient.block(temp_round);

            x = x.txns.transactions;
            x.forEach(e => bar(e))

            current_round += 1;
        }

    })().catch(e => {
        console.log(e);
    });
</script>

<h1 align="center">Algorand's Leaderboard! </h1>
<div id="container" class="center">
</div>
</body>
</html>